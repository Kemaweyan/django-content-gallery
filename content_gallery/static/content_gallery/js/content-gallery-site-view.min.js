(function(a){window.ContentGallery=window.ContentGallery||{};var b=(function(M,e){var l,F,j,g,c,I,t,u,m,h;var G,A,r,p,E;function n(N){if(N<0){g.removeClass("content-gallery-inactive")}else{g.addClass("content-gallery-inactive")}if(N>A){c.removeClass("content-gallery-inactive")}else{c.addClass("content-gallery-inactive")}}function B(O){var R=y();var P=G*O;var N=G*(O+1);var Q=R;if(R+P>=0&&R+N<=m.width()){if(R<A){Q=A}}else{if(R+P<0){Q=-P}if(R+N>m.width()){Q=m.width()-N}}if(R!=Q){e.safeAnimate(j,{left:Q})}n(Q)}function z(O){var N=function(Q){var P=new Image();P.onload=function(){Q.resolve(P)};P.src=O};return a.Deferred(N).promise()}function d(O){var N=M.getImage(O);if(!N){return}I.addClass("choice");a(I[O]).removeClass("choice");if(E){src=N.small_image;size=N.small_image_size}else{src=N.image;size=N.image_size}return{size:size,src:src}}function f(O){var Q=d(O);var N=z(Q.src).then(function(){h.hide()});var P=e.safeAnimate(F,{width:0,height:0}).then(function(){if(N.state()!="resolved"){h.show()}});a.when(N,P).done(function(S,R){F.attr("src",Q.src);e.safeAnimate(F,{width:Q.size.width,height:Q.size.height})})}function o(N){var O=d(N);F.attr("src",O.src).css({width:O.size.width,height:O.size.height})}function q(N){f(N);B(N)}function k(O,N){j.width(G*M.count());var P=Math.ceil(O.width/G)*G;if(P>O.width+140){P-=G}t.width(P+60);I.width(N.width).height(N.height).css("line-height",N.height+"px");t.height(N.height+2);m.width(P)}function J(N){u.height(N);l.css({"line-height":N+"px"})}function H(){if(M.count()<2){return}e.safeRun(function(){index=M.next();q(index)})}function w(){if(M.count()<2){return}e.safeRun(function(){index=M.prev();q(index)})}function i(N){e.safeRun(function(){f(N)})}function y(){return parseInt(j.css("left"))}function L(){j.empty();j.css("left",0)}function v(){e.safeRun(function(){left=y();if(left<0){e.safeAnimate(j,{left:"+="+G});n(left+G)}})}function C(){e.safeRun(function(){left=y();if(left>A){e.safeAnimate(j,{left:"-="+G});n(left-G)}})}function s(){var N=M.current();o(N);k(r,p);A=m.width()-j.width();J(r.height);B(N)}function K(){u=a("#content-gallery-image-view");l=a(".content-gallery-image-container");F=a(".content-gallery-image-container > img");t=a("#content-gallery-thumbnails-view");g=a(".content-gallery-scroll-left");c=a(".content-gallery-scroll-right");m=a(".content-gallery-thumbnails-container");j=a(".content-gallery-thumbnails-container > ul");h=a("#content-gallery-loading-splash");j.on("click","li.choice",function(){i(a(this).index())});a(".content-gallery-prev-image").click(w);a(".content-gallery-next-image").click(H);g.click(v);c.click(C)}function D(O){var N=M.getImageSize();p=M.getThumbnailSize();E=O(N.width+200,N.height+p.height+45);r=E?M.getSmallImageSize():M.getImageSize();G=p.width+8;s();return{width:r.width+200,height:r.height+p.height+45}}function x(N,O){L();M.load(N.app_label,N.content_type,N.object_id,function(P){if(M.count()==0){return}a.each(P,function(R,Q){j.append(a("<li></li>").addClass("choice").addClass("content-gallery-centered-image").append(a("<img>").attr("src",Q.thumbnail)))});if(M.count()>1){a(".content-gallery-prev-widget").removeClass("content-gallery-inactive");a(".content-gallery-next-widget").removeClass("content-gallery-inactive");a(".content-gallery-next-button").css({cursor:"pointer"})}else{a(".content-gallery-prev-widget").addClass("content-gallery-inactive");a(".content-gallery-next-widget").addClass("content-gallery-inactive");a(".content-gallery-next-button").css({cursor:"default"})}I=j.children();O()})}return{init:K,resize:s,setData:x,getSize:D}})(ContentGallery.gallery,ContentGallery.animateSync);ContentGallery.gallerySiteView=b;a(function(){b.init();ContentGallery.galleryView.init(b)})})(jQuery);