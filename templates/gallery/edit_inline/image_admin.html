{% load i18n admin_urls static %}
<div class="js-inline-admin-formset inline-group gallery-inline-formset"
     id="{{ inline_admin_formset.formset.prefix }}-group"
     data-inline-type="stacked"
     data-inline-formset="{{ inline_admin_formset.inline_formset_data }}"{% if inline_admin_formset.formset.instance.pk %}
     object-id="{{ inline_admin_formset.formset.instance.pk }}"
     app-label="{{ inline_admin_formset.formset.instance.gallery.content_type.app_label }}"
     content-type="{{ inline_admin_formset.formset.instance.gallery.content_type.model }}"{% endif %}>
<fieldset class="module {{ inline_admin_formset.classes }}">
  <h2>{{ inline_admin_formset.opts.verbose_name_plural|capfirst }}. DRAG ITEMS TO SET THE ORDER</h2>
{{ inline_admin_formset.formset.management_form }}
{{ inline_admin_formset.formset.non_form_errors }}

<div id="sortedImages" class="imagesContainer">
<input type="hidden" id="id_image">
{% if inline_admin_formset.formset.instance.pk %}
  {% for inline_admin_form in inline_admin_formset %}
    {% if not forloop.last %}<div class="imageObject">
      <div class="imageHeader imageHeaderBg"></div>
      <div class="imageContent">
        <span class="image-delete">{{ inline_admin_form.deletion_field.field.as_hidden }}</span>
        {% for fieldset in inline_admin_form %}
          {% for line in fieldset %}
              {% for field in line %}
                {{ field.field }}
              {% endfor %}
          {% endfor %}
        {% endfor %}
        {% if inline_admin_form.needs_explicit_pk_field %}{{ inline_admin_form.pk_field.field }}{% endif %}
      </div>
    </div>{% endif %}
  {% endfor %}
    <a id="add_id_image" href="/admin/gallery/image/add/?_to_field=id&_popup=1" class="imageObject addNewImage related-widget-wrapper-link add-related"><div class="whiteBox"></div></a>
  </div>
  <div class="imagesToDeleteContainer">
    <div class="imagesHeader imageHeaderBg">THESE IMAGES WILL BE DELETED. DRAG HERE IMAGES YOU WANT TO DELETE</div>
    <div id="imagesToDelete" class="imagesContainer"></div>
  </div>
{% else %}
  Can't attach images to non-existing object. First create the object and then add images.
{% endif %}
</fieldset>
</div>
